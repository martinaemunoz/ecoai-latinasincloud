{% extends "base.html" %}

{% block content %}
<div class="charts-container">
    <h2>An√°lisis Visual del Impacto Ambiental</h2>
    <p class="subtitle">Visualiza c√≥mo diferentes modelos y tipos de consulta afectan el medio ambiente</p>

    <!-- ===============================================
         GR√ÅFICO 1: Comparaci√≥n de impacto por modelo (Barras agrupadas)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Bar Chart (grouped bars)
         - Descripci√≥n: Compara el consumo promedio de agua, energ√≠a y CO‚ÇÇ por modelo
         - Datos necesarios: Promedios por modelo desde dataset (agua, energ√≠a, carbono)
         - Ejes: X = modelo (GPT-4 Turbo, Claude 3 Opus, Gemini 1.5 Pro, Whisper Large V3)
                 Y = cantidad (L para agua, kWh para energ√≠a, gCO2e para carbono)
         - Informaci√≥n √∫til: Claude 3 Opus es el m√°s eficiente en texto, 
                           Gemini consume m√°s energ√≠a en im√°genes
         
         UBICACI√ìN DEL C√ìDIGO: 
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js ‚Üí funci√≥n initModelComparisonChart()
         
         DATOS DE ENTRADA (desde ecoai_dataset.csv):
         Calcular promedios de agua, energ√≠a y carbono para cada modelo
         y pasarlos como variables de contexto desde app.py
    ================================================== -->
    <div class="chart-section">
        <h3>Impacto Ambiental por Modelo</h3>
        <p class="chart-description">Comparaci√≥n de agua, energ√≠a y CO‚ÇÇ consumidos en promedio por cada modelo de IA</p>
        <div style="height: 300px; position: relative;">
            <canvas id="modelComparisonChart"></canvas>
        </div>
    </div>

    <!-- ===============================================
         GR√ÅFICO 2: Impacto por tipo de consulta (Radar o Doughnut)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Radar Chart (alternativa: Doughnut)
         - Descripci√≥n: Visualiza c√≥mo cambia el impacto seg√∫n tipo de consulta
         - Datos: Promedios por tipo_consulta (texto, c√≥digo, imagen, audio, video)
         - M√©trica sugerida: Impacto total = agua + energ√≠a + carbono (normalizado)
         - Insight: Multimedia (imagen, audio, video) tiene 4-5x m√°s impacto que texto
         
         UBICACI√ìN DEL C√ìDIGO:
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js ‚Üí funci√≥n initQueryTypeChart()
         
         DATOS DE ENTRADA:
         - Calcular promedio de impacto para cada tipo_consulta
         - Normalizar valores para comparabilidad en radar (0-100 scale)
    ================================================== -->
    <div class="chart-section">
        <h3>Impacto por Tipo de Consulta</h3>
        <p class="chart-description">Visualiza c√≥mo cambia el consumo ambiental seg√∫n el tipo de tarea (texto, c√≥digo, imagen, etc.)</p>
        <div style="height: 300px; position: relative;">
            <canvas id="queryTypeChart"></canvas>
        </div>
    </div>

    <!-- ===============================================
         GR√ÅFICO 3: Distribuci√≥n de consumo energ√©tico (Pie Chart)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Pie Chart
         - Descripci√≥n: Porcentaje de energ√≠a total por tipo de consulta O por modelo
         - Datos: Suma total de energ√≠a por tipo_consulta (o por modelo)
         - Uso: Resaltar qu√© tareas consumen m√°s energ√≠a relativamente
         
         OPCIONES:
         A) Distribuci√≥n por tipo_consulta: mostrar que imagen/video dominan
         B) Distribuci√≥n por modelo: mostrar cu√°l modelo consume m√°s en total
         
         Recomendaci√≥n: Implementar A (por tipo_consulta) primero, luego ofrecer toggle
         
         UBICACI√ìN DEL C√ìDIGO:
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js ‚Üí funci√≥n initEnergyDistributionChart()
         
         DATOS DE ENTRADA:
         - Sumar energ√≠a total por tipo_consulta
         - Calcular porcentaje de cada tipo respecto al total
    ================================================== -->
    <div class="chart-section">
        <h3>Distribuci√≥n del Consumo Energ√©tico</h3>
        <p class="chart-description">¬øQu√© tipo de consulta consume m√°s energ√≠a? Visualiza los porcentajes totales</p>
        <div style="height: 300px; position: relative; max-width: 400px; margin: 0 auto;">
            <canvas id="energyDistributionChart"></canvas>
        </div>
    </div>

    <!-- ===============================================
         GR√ÅFICO 4: Equivalencias visuales (Cards + infograf√≠as)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: NO es un gr√°fico Chart.js cl√°sico
         - Descripci√≥n: Cards interactivas que muestren equivalencias ambientales
         - Formato sugerido:
           * "1 consulta de c√≥digo en GPT-4 = 20 minutos de ampolleta LED"
           * "10 im√°genes en Gemini = 5 botellas de agua"
           * "100 videos = 1 km en coche"
         
         IMPLEMENTACI√ìN:
         - HTML: Crear cards con √≠conos (üíß agua, ‚ö° energ√≠a, üåç CO‚ÇÇ)
         - JavaScript: Funci√≥n que calcule equivalencias basadas en resultado actual
         - Interactividad: Al cambiar modelo/tipo, actualizar equivalencias din√°micamente
         
         UBICACI√ìN DEL C√ìDIGO:
         - HTML: Este archivo (results_charts.html) - section equivalences-cards
         - JavaScript: static/js/charts.js ‚Üí funci√≥n updateEquivalenceCards()
         
         DATOS DE ENTRADA:
         - Usar los valores eq_agua, eq_energia, eq_co2 del resultado
         - Hacer que sea din√°mico basado en formulario
    ================================================== -->
    <div class="chart-section equivalences">
        <h3>Equivalencias Ambientales</h3>
        <p class="chart-description">¬øQu√© significa en t√©rminos reales el impacto de tus consultas?</p>
        <div class="equivalence-cards" id="equivalenceCards">
            <!-- Aqu√≠ van las cards generadas din√°micamente por JavaScript -->
        </div>
    </div>

    <!-- ===============================================
         GR√ÅFICO 5: Evoluci√≥n del impacto acumulado (Line o Area Chart)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Line Chart o Area Chart
         - Descripci√≥n: Mostrar impacto acumulado con 1, 10, 100, 1000 consultas
         - Ejes: X = n√∫mero de consultas (1, 10, 100, 1000, 10000)
                 Y = consumo acumulado (agua en L, energ√≠a en kWh, carbono en kg)
         - Uso: Proyectar impacto a escala empresarial o mensual
         
         EJEMPLO INTERACTIVO:
         - Selector para elegir modelo y tipo de consulta
         - Gr√°fico actualiza mostrando curva de crecimiento
         - Tooltip muestra equivalencia ("1000 consultas = X duchas")
         
         UBICACI√ìN DEL C√ìDIGO:
         - HTML (canvas + selector): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js ‚Üí funci√≥n initCumulativeImpactChart()
         
         DATOS DE ENTRADA:
         - Tomar valores base de un modelo/tipo seleccionado
         - Multiplicar por 1, 10, 100, 1000, 10000
         - Mostrar curva de crecimiento
    ================================================== -->
    <div class="chart-section">
        <h3>üìà Impacto Acumulado (Proyecci√≥n a Escala)</h3>
        <p class="chart-description">¬øCu√°nto impacto genera hacer muchas consultas? Proyecta el consumo a largo plazo</p>
        <div class="chart-controls">
            <label for="cumulativeModel">Selecciona modelo:</label>
            <select id="cumulativeModel">
                <option value="GPT-4 Turbo">GPT-4 Turbo</option>
                <option value="Claude 3">Claude 3</option>
                <option value="Gemini 1.5">Gemini 1.5</option>
            </select>
            <label for="cumulativeQueryType">Tipo de consulta:</label>
            <select id="cumulativeQueryType">
                <option value="texto">Texto</option>
                <option value="c√≥digo">C√≥digo</option>
                <option value="imagen">Imagen</option>
                <option value="audio">Audio</option>
                <option value="video">Video</option>
            </select>
        </div>
        <div style="height: 350px; position: relative;">
            <canvas id="cumulativeImpactChart"></canvas>
        </div>
    </div>

    <!-- ===============================================
         GR√ÅFICO 6: √çndice de Eficiencia Ambiental (Horizontal Bar)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Horizontal Bar Chart
         - Descripci√≥n: Ranking de eficiencia de modelos
         - M√©trica: Eficiencia = 1 / (agua + energ√≠a + carbono)
                    √≥ usar score inverso donde M√ÅS ALTO = MEJOR
         
         F√ìRMULA SUGERIDA:
         Eficiencia_Score = 100 / (agua_promedio + energ√≠a_promedio + carbono_promedio)
         
         Esto ordena los modelos: cuanto mayor el score, m√°s eficiente
         (menos impacto por consulta)
         
         UBICACI√ìN DEL C√ìDIGO:
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js ‚Üí funci√≥n initEfficiencyIndexChart()
         
         DATOS DE ENTRADA:
         - Calcular promedio de agua, energ√≠a, carbono por modelo
         - Aplicar f√≥rmula de eficiencia
         - Ordenar de mayor a menor eficiencia
    ================================================== -->
    <div class="chart-section">
        <h3>√çndice de Eficiencia Ambiental</h3>
        <p class="chart-description">Ranking de modelos seg√∫n su eficiencia ambiental (puntuaci√≥n m√°s alta = m√°s eficiente)</p>
        <div style="height: 300px; position: relative;">
            <canvas id="efficiencyIndexChart"></canvas>
        </div>
    </div>

    <div class="charts-footer">
        <a href="{{ url_for('index') }}" class="btn-back">‚Üê Volver al formulario</a>
    </div>
</div>

<!-- ===============================================
     SCRIPTS Y DEPENDENCIAS
     ===============================================
     
     ASEG√öRATE DE INCLUIR:
     1. Chart.js (librer√≠a de gr√°ficos)
     2. Archivo local charts.js con todas las funciones
     
     ORDEN DE CARGA IMPORTANTE:
     - Primero: CDN de Chart.js
     - Luego: charts.js local
     - Luego: inicializar gr√°ficos
     
     El HTML de cada canvas debe estar antes de los scripts
================================================== -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>

<script>
    // Datos pasados desde Flask (ver app.py para c√≥mo pasar estos datos)
    const chartData = {
        models: {{ models|safe }},           // Lista de modelos
        queryTypes: {{ query_types|safe }},  // Lista de tipos de consulta
        modelStats: {{ model_stats|safe }},  // Stats por modelo
        queryTypeStats: {{ query_type_stats|safe }} // Stats por tipo
    };
    
    // Inicializar todos los gr√°ficos cuando la p√°gina carga
    document.addEventListener('DOMContentLoaded', function() {
        initModelComparisonChart(chartData);
        initQueryTypeChart(chartData);
        initEnergyDistributionChart(chartData);
        initCumulativeImpactChart(chartData);
        initEfficiencyIndexChart(chartData);
        updateEquivalenceCards(chartData);
    });
    
    // Listener para actualizar gr√°fico acumulado cuando cambian los selects
    document.getElementById('cumulativeModel').addEventListener('change', () => {
        initCumulativeImpactChart(chartData);
    });
    document.getElementById('cumulativeQueryType').addEventListener('change', () => {
        initCumulativeImpactChart(chartData);
    });
</script>

{% endblock %}