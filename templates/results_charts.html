{% extends "base.html" %}

{% block content %}
<div class="charts-container">
    <h2>AnÃ¡lisis Visual del Impacto Ambiental</h2>
    <p class="subtitle">Visualiza cÃ³mo diferentes modelos y tipos de consulta afectan el medio ambiente</p>

    <!-- ===============================================
         GRÃFICO 1: ComparaciÃ³n de impacto por modelo (Barras agrupadas)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Bar Chart (grouped bars)
         - DescripciÃ³n: Compara el consumo promedio de agua, energÃ­a y COâ‚‚ por modelo
         - Datos necesarios: Promedios por modelo desde dataset (agua, energÃ­a, carbono)
         - Ejes: X = modelo (GPT-4 Turbo, Claude 3 Opus, Gemini 1.5 Pro, Whisper Large V3)
                 Y = cantidad (L para agua, kWh para energÃ­a, gCO2e para carbono)
         - InformaciÃ³n Ãºtil: Claude 3 Opus es el mÃ¡s eficiente en texto, 
                           Gemini consume mÃ¡s energÃ­a en imÃ¡genes
         
         UBICACIÃ“N DEL CÃ“DIGO: 
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js â†’ funciÃ³n initModelComparisonChart()
         
         DATOS DE ENTRADA (desde ecoai_dataset.csv):
         Calcular promedios de agua, energÃ­a y carbono para cada modelo
         y pasarlos como variables de contexto desde app.py
    ================================================== -->
    <div class="chart-section">
        <h3>ğŸ“Š Impacto Ambiental por Modelo</h3>
        <p class="chart-description">ComparaciÃ³n de agua, energÃ­a y COâ‚‚ consumidos en promedio por cada modelo de IA</p>
        <canvas id="modelComparisonChart"></canvas>
    </div>

    <!-- ===============================================
         GRÃFICO 2: Impacto por tipo de consulta (Radar o Doughnut)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Radar Chart (alternativa: Doughnut)
         - DescripciÃ³n: Visualiza cÃ³mo cambia el impacto segÃºn tipo de consulta
         - Datos: Promedios por tipo_consulta (texto, cÃ³digo, imagen, audio, video)
         - MÃ©trica sugerida: Impacto total = agua + energÃ­a + carbono (normalizado)
         - Insight: Multimedia (imagen, audio, video) tiene 4-5x mÃ¡s impacto que texto
         
         UBICACIÃ“N DEL CÃ“DIGO:
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js â†’ funciÃ³n initQueryTypeChart()
         
         DATOS DE ENTRADA:
         - Calcular promedio de impacto para cada tipo_consulta
         - Normalizar valores para comparabilidad en radar (0-100 scale)
    ================================================== -->
    <div class="chart-section">
        <h3>ğŸ¯ Impacto por Tipo de Consulta</h3>
        <p class="chart-description">Visualiza cÃ³mo cambia el consumo ambiental segÃºn el tipo de tarea (texto, cÃ³digo, imagen, etc.)</p>
        <canvas id="queryTypeChart"></canvas>
    </div>

    <!-- ===============================================
         GRÃFICO 3: DistribuciÃ³n de consumo energÃ©tico (Pie Chart)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Pie Chart
         - DescripciÃ³n: Porcentaje de energÃ­a total por tipo de consulta O por modelo
         - Datos: Suma total de energÃ­a por tipo_consulta (o por modelo)
         - Uso: Resaltar quÃ© tareas consumen mÃ¡s energÃ­a relativamente
         
         OPCIONES:
         A) DistribuciÃ³n por tipo_consulta: mostrar que imagen/video dominan
         B) DistribuciÃ³n por modelo: mostrar cuÃ¡l modelo consume mÃ¡s en total
         
         RecomendaciÃ³n: Implementar A (por tipo_consulta) primero, luego ofrecer toggle
         
         UBICACIÃ“N DEL CÃ“DIGO:
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js â†’ funciÃ³n initEnergyDistributionChart()
         
         DATOS DE ENTRADA:
         - Sumar energÃ­a total por tipo_consulta
         - Calcular porcentaje de cada tipo respecto al total
    ================================================== -->
    <div class="chart-section">
        <h3>âš¡ DistribuciÃ³n del Consumo EnergÃ©tico</h3>
        <p class="chart-description">Â¿QuÃ© tipo de consulta consume mÃ¡s energÃ­a? Visualiza los porcentajes totales</p>
        <canvas id="energyDistributionChart"></canvas>
    </div>

    <!-- ===============================================
         GRÃFICO 4: Equivalencias visuales (Cards + infografÃ­as)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: NO es un grÃ¡fico Chart.js clÃ¡sico
         - DescripciÃ³n: Cards interactivas que muestren equivalencias ambientales
         - Formato sugerido:
           * "1 consulta de cÃ³digo en GPT-4 = 20 minutos de ampolleta LED"
           * "10 imÃ¡genes en Gemini = 5 botellas de agua"
           * "100 videos = 1 km en coche"
         
         IMPLEMENTACIÃ“N:
         - HTML: Crear cards con Ã­conos (ğŸ’§ agua, âš¡ energÃ­a, ğŸŒ COâ‚‚)
         - JavaScript: FunciÃ³n que calcule equivalencias basadas en resultado actual
         - Interactividad: Al cambiar modelo/tipo, actualizar equivalencias dinÃ¡micamente
         
         UBICACIÃ“N DEL CÃ“DIGO:
         - HTML: Este archivo (results_charts.html) - section equivalences-cards
         - JavaScript: static/js/charts.js â†’ funciÃ³n updateEquivalenceCards()
         
         DATOS DE ENTRADA:
         - Usar los valores eq_agua, eq_energia, eq_co2 del resultado
         - Hacer que sea dinÃ¡mico basado en formulario
    ================================================== -->
    <div class="chart-section equivalences">
        <h3>ğŸ’¡ Equivalencias Ambientales</h3>
        <p class="chart-description">Â¿QuÃ© significa en tÃ©rminos reales el impacto de tus consultas?</p>
        <div class="equivalence-cards" id="equivalenceCards">
            <!-- AquÃ­ van las cards generadas dinÃ¡micamente por JavaScript -->
        </div>
    </div>

    <!-- ===============================================
         GRÃFICO 5: EvoluciÃ³n del impacto acumulado (Line o Area Chart)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Line Chart o Area Chart
         - DescripciÃ³n: Mostrar impacto acumulado con 1, 10, 100, 1000 consultas
         - Ejes: X = nÃºmero de consultas (1, 10, 100, 1000, 10000)
                 Y = consumo acumulado (agua en L, energÃ­a en kWh, carbono en kg)
         - Uso: Proyectar impacto a escala empresarial o mensual
         
         EJEMPLO INTERACTIVO:
         - Selector para elegir modelo y tipo de consulta
         - GrÃ¡fico actualiza mostrando curva de crecimiento
         - Tooltip muestra equivalencia ("1000 consultas = X duchas")
         
         UBICACIÃ“N DEL CÃ“DIGO:
         - HTML (canvas + selector): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js â†’ funciÃ³n initCumulativeImpactChart()
         
         DATOS DE ENTRADA:
         - Tomar valores base de un modelo/tipo seleccionado
         - Multiplicar por 1, 10, 100, 1000, 10000
         - Mostrar curva de crecimiento
    ================================================== -->
    <div class="chart-section">
        <h3>ğŸ“ˆ Impacto Acumulado (ProyecciÃ³n a Escala)</h3>
        <p class="chart-description">Â¿CuÃ¡nto impacto genera hacer muchas consultas? Proyecta el consumo a largo plazo</p>
        <div class="chart-controls">
            <label for="cumulativeModel">Selecciona modelo:</label>
            <select id="cumulativeModel">
                <option value="GPT-4 Turbo">GPT-4 Turbo</option>
                <option value="Claude 3">Claude 3</option>
                <option value="Gemini 1.5">Gemini 1.5</option>
            </select>
            <label for="cumulativeQueryType">Tipo de consulta:</label>
            <select id="cumulativeQueryType">
                <option value="texto">Texto</option>
                <option value="cÃ³digo">CÃ³digo</option>
                <option value="imagen">Imagen</option>
                <option value="audio">Audio</option>
                <option value="video">Video</option>
            </select>
        </div>
        <canvas id="cumulativeImpactChart"></canvas>
    </div>

    <!-- ===============================================
         GRÃFICO 6: Ãndice de Eficiencia Ambiental (Horizontal Bar)
         ===============================================
         
         INSTRUCCIONES PARA IMPLEMENTAR:
         - Tipo: Chart.js Horizontal Bar Chart
         - DescripciÃ³n: Ranking de eficiencia de modelos
         - MÃ©trica: Eficiencia = 1 / (agua + energÃ­a + carbono)
                    Ã³ usar score inverso donde MÃS ALTO = MEJOR
         
         FÃ“RMULA SUGERIDA:
         Eficiencia_Score = 100 / (agua_promedio + energÃ­a_promedio + carbono_promedio)
         
         Esto ordena los modelos: cuanto mayor el score, mÃ¡s eficiente
         (menos impacto por consulta)
         
         UBICACIÃ“N DEL CÃ“DIGO:
         - HTML (canvas): Este archivo (results_charts.html)
         - JavaScript: static/js/charts.js â†’ funciÃ³n initEfficiencyIndexChart()
         
         DATOS DE ENTRADA:
         - Calcular promedio de agua, energÃ­a, carbono por modelo
         - Aplicar fÃ³rmula de eficiencia
         - Ordenar de mayor a menor eficiencia
    ================================================== -->
    <div class="chart-section">
        <h3>ğŸŒ¿ Ãndice de Eficiencia Ambiental</h3>
        <p class="chart-description">Ranking de modelos segÃºn su eficiencia ambiental (puntuaciÃ³n mÃ¡s alta = mÃ¡s eficiente)</p>
        <canvas id="efficiencyIndexChart"></canvas>
    </div>

    <div class="charts-footer">
        <a href="{{ url_for('index') }}" class="btn-back">â† Volver al formulario</a>
    </div>
</div>

<!-- ===============================================
     SCRIPTS Y DEPENDENCIAS
     ===============================================
     
     ASEGÃšRATE DE INCLUIR:
     1. Chart.js (librerÃ­a de grÃ¡ficos)
     2. Archivo local charts.js con todas las funciones
     
     ORDEN DE CARGA IMPORTANTE:
     - Primero: CDN de Chart.js
     - Luego: charts.js local
     - Luego: inicializar grÃ¡ficos
     
     El HTML de cada canvas debe estar antes de los scripts
================================================== -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>

<script>
    // Datos pasados desde Flask (ver app.py para cÃ³mo pasar estos datos)
    const chartData = {
        models: {{ models|safe }},           // Lista de modelos
        queryTypes: {{ query_types|safe }},  // Lista de tipos de consulta
        modelStats: {{ model_stats|safe }},  // Stats por modelo
        queryTypeStats: {{ query_type_stats|safe }} // Stats por tipo
    };
    
    // Inicializar todos los grÃ¡ficos cuando la pÃ¡gina carga
    document.addEventListener('DOMContentLoaded', function() {
        initModelComparisonChart(chartData);
        initQueryTypeChart(chartData);
        initEnergyDistributionChart(chartData);
        initCumulativeImpactChart(chartData);
        initEfficiencyIndexChart(chartData);
        updateEquivalenceCards(chartData);
    });
    
    // Listener para actualizar grÃ¡fico acumulado cuando cambian los selects
    document.getElementById('cumulativeModel').addEventListener('change', () => {
        initCumulativeImpactChart(chartData);
    });
    document.getElementById('cumulativeQueryType').addEventListener('change', () => {
        initCumulativeImpactChart(chartData);
    });
</script>

{% endblock %}