{% extends "base.html" %}

{% block content %}
<div class="charts-container">
    <h2>Análisis Visual del Impacto Ambiental</h2>
    <p class="subtitle">Visualiza cómo diferentes modelos y tipos de consulta afectan el medio ambiente</p>
    <!-- gráfico 1 -->
    <div class="chart-section">
        <h3>Impacto Ambiental por Modelo</h3>
        <p class="chart-description">Comparación de agua, energía y CO₂ consumidos en promedio por cada modelo de IA</p>
        <div style="height: 300px; position: relative;">
            <canvas id="modelComparisonChart"></canvas>
        </div>
    </div>

    <!-- gráfico 2 -->
    <div class="chart-section">
        <h3>Impacto por Tipo de Consulta</h3>
        <p class="chart-description">Visualiza cómo cambia el consumo ambiental según el tipo de tarea (texto, código, imagen, etc.)</p>
        <div style="height: 300px; position: relative;">
            <canvas id="queryTypeChart"></canvas>
        </div>
    </div>

    <!-- gráfico 3 -->
    <div class="chart-section">
        <h3>Distribución del Consumo Energético</h3>
        <p class="chart-description">¿Qué tipo de consulta consume más energía? Visualiza los porcentajes totales</p>
        <div style="height: 300px; position: relative; max-width: 400px; margin: 0 auto;">
            <canvas id="energyDistributionChart"></canvas>
        </div>
    </div>

    <!-- gráfico 4 -->
    <div class="chart-section">
        <h3>Evolución del Impacto Acumulado</h3>
        <p class="chart-description">Proyección del impacto ambiental a medida que aumentan las consultas</p>
        <div style="height: 300px; position: relative;">
            <canvas id="cumulativeImpactChart"></canvas>
        </div>
    </div>

    <div class="chart-section">
        <h3>Impacto Acumulado (Proyección a Escala)</h3>
        <p class="chart-description">¿Cuánto impacto genera hacer muchas consultas? Proyecta el consumo a largo plazo</p>
        <div class="chart-controls">
            <label for="cumulativeModel">Selecciona modelo:</label>
            <select id="cumulativeModel">
                <option value="GPT-4 Turbo">GPT-4 Turbo</option>
                <option value="Claude 3">Claude 3</option>
                <option value="Gemini 1.5">Gemini 1.5</option>
            </select>
            <label for="cumulativeQueryType">Tipo de consulta:</label>
            <select id="cumulativeQueryType">
                <option value="texto">Texto</option>
                <option value="código">Código</option>
                <option value="imagen">Imagen</option>
                <option value="audio">Audio</option>
                <option value="video">Video</option>
            </select>
        </div>
        <div style="height: 350px; position: relative;">
            <canvas id="cumulativeImpactChart"></canvas>
        </div>
    </div>

    <!-- gráfico 5 -->
    <div class="chart-section">
        <h3>Índice de Eficiencia Ambiental</h3>
        <p class="chart-description">Ranking de modelos según su eficiencia ambiental (puntuación más alta = más eficiente)</p>
        <div style="height: 300px; position: relative;">
            <canvas id="efficiencyIndexChart"></canvas>
        </div>
    </div>

    <div class="charts-footer">
        <a href="{{ url_for('index') }}" class="btn-back">← Volver al formulario</a>
    </div>
</div>

<!-- scripts y dependencias -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>

<script>
    // datos pasados desde Flask (ver app.py para cómo pasar estos datos)
    const chartData = {
        models: {{ models|safe }},           // Lista de modelos
        queryTypes: {{ query_types|safe }},  // Lista de tipos de consulta
        modelStats: {{ model_stats|safe }},  // Stats por modelo
        queryTypeStats: {{ query_type_stats|safe }} // Stats por tipo
    };
    
    // inicializar gráficos cuando la página carga
    document.addEventListener('DOMContentLoaded', function() {
        initModelComparisonChart(chartData);
        initQueryTypeChart(chartData);
        initEnergyDistributionChart(chartData);
        initCumulativeImpactChart(chartData);
        initEfficiencyIndexChart(chartData);
    });
    
    // listener para actualizar gráfico acumulado cuando cambian los selects (no operativo aún)
    document.getElementById('cumulativeModel').addEventListener('change', () => {
        initCumulativeImpactChart(chartData);
    });
    document.getElementById('cumulativeQueryType').addEventListener('change', () => {
        initCumulativeImpactChart(chartData);
    });
</script>

{% endblock %}